<?xml version="1.0"?>
<robot name="mycobot_280_gazebo">

  <!-- Fix the robot to the world so the base can't tip -->
  <link name="world"/>
  <joint name="world_to_g_base" type="fixed">
    <parent link="world"/>
    <child link="g_base"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- ===== Base link ===== -->
  <link name="g_base">
    <visual>
      <geometry>
        <mesh filename="package://mycobot_description/urdf/mycobot_280_pi/G_base.dae"/>
      </geometry>
      <origin xyz="0 0 -0.03" rpy="0 0 1.5708"/>
    </visual>
    <collision>
      <geometry><box size="0.08 0.08 0.04"/></geometry>
      <!-- keep collision aligned like your friend's -->
      <origin xyz="0 0 -0.03" rpy="0 0 1.5708"/>
    </collision>
    <inertial>
      <mass value="0.30"/>
      <inertia ixx="1e-3" ixy="0" ixz="0" iyy="1e-3" iyz="0" izz="1e-3"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </inertial>
  </link>

  <!-- Improve base-ground friction to avoid sliding -->
  <gazebo reference="g_base">
    <mu1>1.0</mu1>
    <mu2>1.0</mu2>
    <maxContacts>10</maxContacts>
    <kp>1e6</kp>
    <kd>1.0</kd>
  </gazebo>

  <!-- ===== Joint 1 (baked upright STL, +90Â° roll) ===== -->
  <link name="joint1">
    <visual>
      <geometry>
        <mesh filename="package://mycobot_description/urdf/mycobot_280_pi/joint1_pi_fixed.stl"/>
      </geometry>
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
    </visual>
    <collision>
      <geometry><box size="0.06 0.06 0.06"/></geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.25"/>
      <inertia ixx="8e-4" ixy="0" ixz="0" iyy="8e-4" iyz="0" izz="8e-4"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </inertial>
  </link>

  <!-- ===== Joint 2 ===== -->
  <link name="joint2">
    <visual>
      <geometry><mesh filename="package://mycobot_description/urdf/mycobot_280_pi/joint2.dae"/></geometry>
      <origin xyz="0 0 -0.06096" rpy="0 0 -1.5708"/>
    </visual>
    <collision>
      <geometry><box size="0.05 0.05 0.08"/></geometry>
      <origin xyz="0 0 -0.06096" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.20"/>
      <inertia ixx="6e-4" ixy="0" ixz="0" iyy="6e-4" iyz="0" izz="6e-4"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </inertial>
  </link>

  <!-- ===== Joint 3 ===== -->
  <link name="joint3">
    <visual>
      <geometry><mesh filename="package://mycobot_description/urdf/mycobot_280_pi/joint3.dae"/></geometry>
      <origin xyz="0 0 0.03256" rpy="0 -1.5708 0"/>
    </visual>
    <collision>
      <geometry><box size="0.05 0.05 0.06"/></geometry>
      <origin xyz="0 0 0.03" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.18"/>
      <inertia ixx="5e-4" ixy="0" ixz="0" iyy="5e-4" iyz="0" izz="5e-4"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </inertial>
  </link>

  <!-- ===== Joint 4 ===== -->
  <link name="joint4">
    <visual>
      <geometry><mesh filename="package://mycobot_description/urdf/mycobot_280_pi/joint4.dae"/></geometry>
      <origin xyz="0 0 0.03056" rpy="0 -1.5708 0"/>
    </visual>
    <collision>
      <geometry><box size="0.05 0.05 0.05"/></geometry>
      <origin xyz="0 0 0.03" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.15"/>
      <inertia ixx="4e-4" ixy="0" ixz="0" iyy="4e-4" iyz="0" izz="4e-4"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </inertial>
  </link>

  <!-- ===== Joint 5 (baked STL) ===== -->
  <link name="joint5">
    <visual>
      <geometry><mesh filename="package://mycobot_description/urdf/mycobot_280_pi/joint5_fixed.stl"/></geometry>
      <origin xyz="0 -0.001 -0.0345" rpy="0 -1.5708 3.1416"/>
    </visual>
    <collision>
      <geometry><box size="0.04 0.04 0.04"/></geometry>
      <origin xyz="0 0 -0.03" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.12"/>
      <inertia ixx="3e-4" ixy="0" ixz="0" iyy="3e-4" iyz="0" izz="3e-4"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </inertial>
  </link>

  <!-- ===== Joint 6 ===== -->
  <link name="joint6">
    <visual>
      <geometry><mesh filename="package://mycobot_description/urdf/mycobot_280_pi/joint6.dae"/></geometry>
      <origin xyz="0 0 -0.038" rpy="0 0 0"/>
    </visual>
    <collision>
      <geometry><box size="0.04 0.04 0.04"/></geometry>
      <origin xyz="0 0 -0.03" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.10"/>
      <inertia ixx="2e-4" ixy="0" ixz="0" iyy="2e-4" iyz="0" izz="2e-4"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </inertial>
  </link>

  <!-- ===== Flange ===== -->
  <link name="joint6_flange">
    <visual>
      <geometry><mesh filename="package://mycobot_description/urdf/mycobot_280_pi/joint7.dae"/></geometry>
      <origin xyz="0 0 -0.012" rpy="0 0 0"/>
    </visual>
    <collision>
      <geometry><box size="0.03 0.03 0.03"/></geometry>
      <origin xyz="0 0 -0.012" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.08"/>
      <inertia ixx="1.5e-4" ixy="0" ixz="0" iyy="1.5e-4" iyz="0" izz="1.5e-4"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </inertial>
  </link>

  <!-- ===== Joints ===== -->
  <joint name="g_base_to_joint1" type="fixed">
    <parent link="g_base"/>
    <child link="joint1"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <joint name="joint2_to_joint1" type="revolute">
    <parent link="joint1"/>
    <child link="joint2"/>
    <origin xyz="0 0 0.13956" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="1.5" friction="0.05"/>
    <limit lower="-2.9322" upper="2.9322" effort="5.0" velocity="2.0"/>
  </joint>

  <joint name="joint3_to_joint2" type="revolute">
    <parent link="joint2"/>
    <child link="joint3"/>
    <origin xyz="0 0 -0.001" rpy="0 1.5708 -1.5708"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="1.5" friction="0.05"/>
    <limit lower="-2.3562" upper="2.3562" effort="5.0" velocity="2.0"/>
  </joint>

  <joint name="joint4_to_joint3" type="revolute">
    <parent link="joint3"/>
    <child link="joint4"/>
    <origin xyz="-0.1104 0 0" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="1.5" friction="0.05"/>
    <limit lower="-2.618" upper="2.618" effort="5.0" velocity="2.0"/>
  </joint>

  <joint name="joint5_to_joint4" type="revolute">
    <parent link="joint4"/>
    <child link="joint5"/>
    <origin xyz="-0.096 0 0.06462" rpy="0 0 -1.5708"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="1.5" friction="0.05"/>
    <limit lower="-2.5307" upper="2.5307" effort="5.0" velocity="2.0"/>
  </joint>

  <joint name="joint6_to_joint5" type="revolute">
    <parent link="joint5"/>
    <child link="joint6"/>
    <origin xyz="0 -0.07318 -0.001" rpy="1.5708 -1.5708 0"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="1.5" friction="0.05"/>
    <limit lower="-2.8798" upper="2.8798" effort="5.0" velocity="2.0"/>
  </joint>

  <joint name="joint6output_to_joint6" type="revolute">
    <parent link="joint6"/>
    <child link="joint6_flange"/>
    <origin xyz="0 0.0456 0" rpy="-1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="1.5" friction="0.05"/>
    <limit lower="-3.14159" upper="3.14159" effort="5.0" velocity="2.0"/>
  </joint>

  <!-- Gazebo ros2_control plugin -->
  <gazebo>
    <plugin name="gz_ros2_control::GazeboSimROS2ControlPlugin"
            filename="libgz_ros2_control-system.so">
      <parameters>/home/bykes/mycobot_ws/install/mycobot_280_gazebo/share/mycobot_280_gazebo/config/mycobot_280_controllers.yaml</parameters>
    </plugin>
  </gazebo>

  <!-- ros2_control interfaces -->
  <ros2_control name="MycobotSystem" type="system">
    <hardware>
      <plugin>gz_ros2_control/GazeboSimSystem</plugin>
      <param name="enable_joint_filtering">true</param>
    </hardware>

    <joint name="joint2_to_joint1"><command_interface name="position"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="joint3_to_joint2"><command_interface name="position"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="joint4_to_joint3"><command_interface name="position"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="joint5_to_joint4"><command_interface name="position"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="joint6_to_joint5"><command_interface name="position"/><state_interface name="position"/><state_interface name="velocity"/></joint>
    <joint name="joint6output_to_joint6"><command_interface name="position"/><state_interface name="position"/><state_interface name="velocity"/></joint>
  </ros2_control>

</robot>

